{"ast":null,"code":"import _slicedToArray from\"/home/xkruzel/Desktop/todo/reactapp/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import*as THREE from'three';import{OrbitControls}from'three/examples/jsm/controls/OrbitControls';import*as dat from'dat.gui';import{Point}from'./Point';import{Font}from'three/examples/jsm/loaders/FontLoader.js';import{TextGeometry}from'three/examples/jsm/geometries/TextGeometry.js';import{Interaction}from'three.interaction-fixed';function dec2bin(dec,n){var res=(dec>>>0).toString(2);if(res.length<n){for(var i=0;i<n-res.length;++i){res='0'+res;}}return res;}export function init3Dgraphics(element,data,nodes_ids,h,w){if(data===undefined){return false;}var CYLINDER_HEIGHT=5;var scene=new THREE.Scene();//scene.background = new THREE.Color( 0xd3d3d3 );\nscene.background=new THREE.Color(0xf8f2ea);var camera=new THREE.PerspectiveCamera(75,element.width/element.height,0.1,1000);var renderer=new THREE.WebGLRenderer({canvas:element});renderer.setPixelRatio(window.devicePixelRatio);renderer.setSize(element.width,element.height);// full size\ncamera.position.setZ(30);// for better perspective\nrenderer.sortObjects=false;renderer.render(scene,camera);var interaction=new Interaction(renderer,scene,camera);var fontJson=require(\"./fonts/Caviar_Dreams_Bold.json\");var font=new Font(fontJson);var texts=[];var mouse=new THREE.Vector2();function onMouseMove(event){if(event.clientX>w+element.width||event.clientX<w||event.clientY>h+element.height||event.clientY<h){return;}//console.log('computing in ', index);\n// calculate pointer position in normalized device coordinates\n// (-1 to +1) for both components\nmouse.x=(event.clientX-h)/element.width*2-1;mouse.y=-(event.clientY/element.height)*2+1;// console.log(mouse);\n}var axesHelper=new THREE.AxesHelper(100);//scene.add(axesHelper);\nvar gui=new dat.GUI();var options={sphereColor:0xffea00,wireframe:false};var pointLight=new THREE.PointLight(0xffffff);pointLight.position.set(20,20,20);var ambientLight=new THREE.AmbientLight(0xffffff);ambientLight.position.set(20,20,20);scene.add(pointLight,ambientLight);var lightHelper=new THREE.PointLightHelper(pointLight);// shows position of lighsource\nvar gridHelper=new THREE.GridHelper(30,20);//scene.add(lightHelper, gridHelper);\nwindow.addEventListener('resize',function(){camera.aspect=element.width/element.height;camera.updateProjectionMatrix();renderer.setSize(element.width);});var controls=new OrbitControls(camera,renderer.domElement);var nodes_to_id={};/*\n  function resetMaterials() {\n    for (let i = 0; i < scene.children.length; i++) {\n      if (scene.children[i].material) {\n        scene.children[i].material.opacity = 1.0;\n      }\n    }\n  }\n\n\n  function hoverPieces() {\n    raycaster.setFromCamera(mouse, camera);\n    const intersects = raycaster.intersectObjects(scene.children);\n\n    for (let i = 0; i < intersects.length; i++) {\n      const newMaterial = intersects[i].object.material.clone();\n      newMaterial.transparent = true;\n      newMaterial.opacity = 0.5;\n      intersects[i].object.material = newMaterial;\n    }\n  }\n\n  function onClick() {\n    texts.forEach((text) => { removeObject3D(text) });\n\n    raycaster.setFromCamera(mouse, camera);\n    let intersects = raycaster.intersectObjects(scene.children);\n\n    if (intersects.length === 1) {\n      const obj = intersects[0].object;\n      var text = '';\n      nodes_to_id[obj.id].forEach(function (elem) {\n        if (text !== '') {\n          text += ',';\n        }\n        text += ' (';\n        const bin = dec2bin(elem, nodes_ids.length);\n\n        for (let i = 0; i < bin.length; i++) {\n          if (bin[i] === '1') {\n            text += ' ' + nodes_ids[i];\n          }\n        }\n        text += ')';\n      });\n\n      const geometry = new TextGeometry(text, {\n        font : font,\n        size : 1,\n        height : 1,\n      });\n\n      const textMesh = new THREE.Mesh(geometry, [\n        new THREE.MeshPhongMaterial( { color : 0x000000 } )\n      ]);\n\n      textMesh.position.x = obj.position.x;\n      textMesh.position.y = obj.position.y;\n      textMesh.position.z = obj.position.z + 10;\n\n      texts.push(textMesh);\n      scene.add(textMesh);      \n    }\n  }\n\n  function removeObject3D(object3D) {\n    if (!(object3D instanceof THREE.Object3D)) return false;\n\n    // for better memory management and performance\n    if (object3D.geometry) object3D.geometry.dispose();\n\n    if (object3D.material) {\n        if (object3D.material instanceof Array) {\n            // for better memory management and performance\n            object3D.material.forEach(material => material.dispose());\n        } else {\n            // for better memory management and performance\n            object3D.material.dispose();\n        }\n    }\n    object3D.removeFromParent(); // the parent might be the scene or another Object3D, but it is sure to be removed this way\n    return true;\n}\n*/processClusters(scene,data);data=null;function animate(){setTimeout(function(){requestAnimationFrame(animate);},1000/5);controls.update();// resetMaterials();\n// hoverPieces();\nrenderer.render(scene,camera);}renderer.setAnimationLoop(animate);window.addEventListener('click',onClick);window.addEventListener('mousemove',onMouseMove);window.addEventListener('resize',function(){camera.aspect=element.width/element.width;camera.updateProjectionMatrix();renderer.setSize(element.width,element.width);});function calcColor(max,val){return\"hsla(147, 0%, 50%, 1)\";var min=0;var minHue=240,maxHue=0;var curPercent=(val-min)/(max-min);var colString=\"hsl(\"+(curPercent*(maxHue-minHue)+minHue)+\",65%,50%)\";return colString;}function createCylinder(data,id,startPoint,endPoint,currRadius,nextRadius,rank,rank_max){var color=new THREE.Color(data[id]['Color']===''?calcColor(rank_max,rank):data[id]['Color']);//color.setHex(rank/10 * 0xffffff );\n// color.setHex(rank/10 * 0xffffff );\nvar cylinderMesh=function cylinderMesh(startPoint,endPoint,midPoint,currRadius,nextRadius,color){/* edge from X to Y */var direction=new THREE.Vector3().subVectors(endPoint,startPoint);var orientation=new THREE.Matrix4();/* THREE.Object3D().up (=Y) default orientation for all objects */orientation.lookAt(startPoint,endPoint,new THREE.Object3D().up);/* rotation around axis X by -90 degrees \n      * matches the default orientation Y \n      * with the orientation of looking Z */var mat=new THREE.Matrix4();mat.set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1);orientation.multiply(mat);/* cylinder: radiusAtTop, radiusAtBottom, \n          height, radiusSegments, heightSegments */var edgeGeometry=new THREE.CylinderGeometry(nextRadius,currRadius,direction.length(),8,1);var cylinder=new THREE.Mesh(edgeGeometry,new THREE.MeshPhongMaterial({color:color,flatShading:true}));cylinder.applyMatrix4(orientation);cylinder.position.set(midPoint.x,midPoint.y,midPoint.z);nodes_to_id[cylinder.id]=data[id][\"Nodes\"];cylinder.cursor='pointer';cylinder.on('click',function(ev){var text='';data[id][\"Nodes\"].forEach(function(elem){if(text!==''){text+=',';}text+=' (';var bin=dec2bin(elem,nodes_ids.length);for(var i=0;i<bin.length;i++){if(bin[i]==='1'){text+=' '+nodes_ids[i];}}text+=')';});var geometry=new TextGeometry(text,{font:font,size:1,height:1});var textMesh=new THREE.Mesh(geometry,[new THREE.MeshPhongMaterial({color:0x000000})]);textMesh.position.x=cylinder.position.x;textMesh.position.y=cylinder.position.y;textMesh.position.z=cylinder.position.z+10;texts.push(textMesh);scene.add(textMesh);});return cylinder;};var midPoint=new Point((startPoint.x+endPoint.x)/2,(startPoint.y+endPoint.y)/2,(startPoint.z+endPoint.z)/2);return cylinderMesh(startPoint,endPoint,midPoint,currRadius,nextRadius,color);//new THREE.Mesh(geometryCyl, material);\n}// prevPoint, point - upper and downer middle points of cylinder\n// dirPoint - point to which direction of cylinder (dir vector) should go \nfunction clustering(scene,data,id,max_branching,branch_count,prevPointFirst,pointFirst,biggestRank){if(id===undefined){console.log(\"Id is undefined in clustering\");return;}var tuple=Object.freeze({id:id,prevPoint:prevPointFirst,point:pointFirst});var stack=[tuple];var count=0;while(stack.length>0){++count;var stackElement=stack.pop();var current=stackElement.id;var prevPoint=stackElement.prevPoint;var point=stackElement.point;var cluster=data[current];var childCount=cluster[\"Desc\"].length;var childsChildCount=0;for(var i=0;i<cluster[\"Desc\"].length;++i){childsChildCount+=data[cluster[\"Desc\"][i]][\"NodeCount\"];}var cylinder=createCylinder(data,current,prevPoint,point,cluster.NodeCount,childsChildCount,data[current][\"Rank\"],biggestRank);var prevPointPointDist=Math.sqrt((point.x-prevPoint.x)*(point.x-prevPoint.x)+(point.y-prevPoint.y)*(point.y-prevPoint.y)+(point.z-prevPoint.z)*(point.z-prevPoint.z));for(i=0;i<childCount;++i){if(childCount===1){var newStartPoint=new Point(point.x,point.y,point.z);// to make copy\nvar offset=0;if(childsChildCount===cluster[\"Desc\"].length&&childsChildCount!==0&&data[cluster[\"Desc\"][0]][\"Desc\"].length!==0){cylinder=undefined;// join same-like cluster to one - draw one cluster with bigger height\nnewStartPoint=new Point(prevPoint.x,prevPoint.y,prevPoint.z);// to make copy\n}var dirVector=new THREE.Vector3(point.x-prevPoint.x,point.y-prevPoint.y,point.z-prevPoint.z);var newPoint=new Point(dirVector.x+point.x,dirVector.y+point.y,dirVector.z+point.z);tuple=Object.freeze({id:cluster[\"Desc\"][0],prevPoint:newStartPoint,point:newPoint});stack.push(tuple);continue;}// COMPUTE NEW COORDINATES around circle\nvar theta=2*Math.PI/childCount*i;var xPos=Math.cos(theta)*childsChildCount;var zPos=Math.sin(theta)*childsChildCount;// this point is not exactly matching with rotation line\n// it is used to compute vector and later in correct newStartPoint\nvar newStartPointHelper=new Point(point.x+xPos,point.y,point.z+zPos);var vector=new THREE.Vector3(newStartPointHelper.x-prevPoint.x,newStartPointHelper.y-prevPoint.y,newStartPointHelper.z-prevPoint.z).normalize();var distance=Math.sqrt(cluster.NodeCount*cluster.NodeCount+prevPointPointDist*prevPointPointDist);newStartPoint=new Point(prevPoint.x+distance*vector.x,prevPoint.y+distance*vector.y,prevPoint.z+distance*vector.z);var branch_factor=2-1/max_branching*branch_count;xPos=Math.cos(theta)*childsChildCount*branch_factor;// TODO pronasobit constantov pro urceni mensiho/vetsiho uhlu - v ramci hlbky stromu? \nzPos=Math.sin(theta)*childsChildCount*branch_factor;// TODO\nvar newEndPoint=new Point(newStartPoint.x+xPos,newStartPoint.y-CYLINDER_HEIGHT,newStartPoint.z+zPos);tuple=Object.freeze({id:cluster[\"Desc\"][i],prevPoint:newStartPoint,point:newEndPoint});stack.push(tuple);}if(cylinder!==undefined){scene.add(cylinder);}}}function compMaxBranching(data,key){var stack=[key];var maximums={};var colors={};while(stack.length>0){var current=stack.pop();colors[current]='G';stack.push(current);if(maximums[current]===undefined){maximums[current]=0;}var count_black=0;var desc_count=data[current][\"Desc\"].length;for(var i=0;i<desc_count;++i){if(colors[data[current][\"Desc\"][i]]===undefined){stack.push(data[current][\"Desc\"][i]);}if(colors[data[current][\"Desc\"][i]]==='B'){count_black+=1;maximums[current]=Math.max(maximums[data[current][\"Desc\"][i]],maximums[current]);}}if(count_black===desc_count){colors[current]='B';stack.pop();if(desc_count>1){maximums[current]+=1;}}}return maximums[key];}function processClusters(scene,data){var root_cluster_key=undefined;var maxCluster=1;var biggestRank=0;Object.entries(data).forEach(function(_ref){var _ref2=_slicedToArray(_ref,2),k=_ref2[0],v=_ref2[1];if(v[\"Rank\"]===0){root_cluster_key=k;}biggestRank=Math.max(v[\"Rank\"],biggestRank);maxCluster=Math.max(maxCluster,v.NodeCount);});var max_branching=compMaxBranching(data,root_cluster_key);var firstHeight=biggestRank*CYLINDER_HEIGHT/2+CYLINDER_HEIGHT;var firstStartPoint=new Point(0,firstHeight,0);var firstEndPoint=new Point(0,firstHeight-CYLINDER_HEIGHT,0);clustering(scene,data,root_cluster_key,max_branching,1,firstStartPoint,firstEndPoint,biggestRank);}}","map":{"version":3,"names":["THREE","OrbitControls","dat","Point","Font","TextGeometry","Interaction","dec2bin","dec","n","res","toString","length","i","init3Dgraphics","element","data","nodes_ids","h","w","undefined","CYLINDER_HEIGHT","scene","Scene","background","Color","camera","PerspectiveCamera","width","height","renderer","WebGLRenderer","canvas","setPixelRatio","window","devicePixelRatio","setSize","position","setZ","sortObjects","render","interaction","fontJson","require","font","texts","mouse","Vector2","onMouseMove","event","clientX","clientY","x","y","axesHelper","AxesHelper","gui","GUI","options","sphereColor","wireframe","pointLight","PointLight","set","ambientLight","AmbientLight","add","lightHelper","PointLightHelper","gridHelper","GridHelper","addEventListener","aspect","updateProjectionMatrix","controls","domElement","nodes_to_id","processClusters","animate","setTimeout","requestAnimationFrame","update","setAnimationLoop","onClick","calcColor","max","val","min","minHue","maxHue","curPercent","colString","createCylinder","id","startPoint","endPoint","currRadius","nextRadius","rank","rank_max","color","cylinderMesh","midPoint","direction","Vector3","subVectors","orientation","Matrix4","lookAt","Object3D","up","mat","multiply","edgeGeometry","CylinderGeometry","cylinder","Mesh","MeshPhongMaterial","flatShading","applyMatrix4","z","cursor","on","ev","text","forEach","elem","bin","geometry","size","textMesh","push","clustering","max_branching","branch_count","prevPointFirst","pointFirst","biggestRank","console","log","tuple","Object","freeze","prevPoint","point","stack","count","stackElement","pop","current","cluster","childCount","childsChildCount","NodeCount","prevPointPointDist","Math","sqrt","newStartPoint","offset","dirVector","newPoint","theta","PI","xPos","cos","zPos","sin","newStartPointHelper","vector","normalize","distance","branch_factor","newEndPoint","compMaxBranching","key","maximums","colors","count_black","desc_count","root_cluster_key","maxCluster","entries","k","v","firstHeight","firstStartPoint","firstEndPoint"],"sources":["/home/xkruzel/Desktop/todo/reactapp/src/rendering.js"],"sourcesContent":["import * as THREE from 'three';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\nimport * as dat from 'dat.gui';\nimport { Point } from './Point';\nimport { Font } from 'three/examples/jsm/loaders/FontLoader.js';\nimport { TextGeometry } from 'three/examples/jsm/geometries/TextGeometry.js';\nimport { Interaction } from 'three.interaction-fixed';\n\nfunction dec2bin(dec, n) {\n  var res = (dec >>> 0).toString(2);\n\n  if (res.length < n) {\n    for (let i = 0; i < (n - res.length); ++i) {\n      res = '0' + res;\n    }\n  }\n\n  return res;\n}\n\nexport function init3Dgraphics(element, data, nodes_ids, h, w) {\n\n  if (data === undefined) {\n    return false;\n  }\n\n  const CYLINDER_HEIGHT = 5;\n\n  const scene = new THREE.Scene();\n  //scene.background = new THREE.Color( 0xd3d3d3 );\n  scene.background = new THREE.Color( 0xf8f2ea);\n  const camera = new THREE.PerspectiveCamera(75, element.width / element.height, 0.1, 1000)\n  const renderer = new THREE.WebGLRenderer({\n    canvas: element,\n  });\n\n  renderer.setPixelRatio( window.devicePixelRatio );\n  renderer.setSize(element.width, element.height); // full size\n  camera.position.setZ(30); // for better perspective\n  renderer.sortObjects = false;\n  renderer.render(scene, camera);\n\n  const interaction = new Interaction(renderer, scene, camera);\n\n  const fontJson = require( \"./fonts/Caviar_Dreams_Bold.json\" );\n  const font = new Font( fontJson );\n  var texts = [];\n\n  var mouse = new THREE.Vector2();\n\n  function onMouseMove( event ) {\n    if (event.clientX > (w + element.width) || event.clientX < w\n    || event.clientY > (h + element.height) || event.clientY < h      \n    ) {\n      return;\n    }\n    //console.log('computing in ', index);\n\n    // calculate pointer position in normalized device coordinates\n    // (-1 to +1) for both components\n\n    mouse.x = ( (event.clientX - h) / element.width) * 2 - 1;\n    mouse.y = - ( (event.clientY) / element.height) * 2 + 1;\n   // console.log(mouse);\n  }\n\n  const axesHelper = new THREE.AxesHelper(100);\n  //scene.add(axesHelper);\n\n  const gui = new dat.GUI();\n  const options = {\n    sphereColor : 0xffea00,\n    wireframe: false,\n  };\n    \n  const pointLight = new THREE.PointLight(0xffffff)\n  pointLight.position.set(20, 20, 20);\n\n  const ambientLight = new THREE.AmbientLight(0xffffff)\n  ambientLight.position.set(20, 20, 20);\n\n  scene.add(pointLight, ambientLight);\n\n  const lightHelper = new THREE.PointLightHelper(pointLight);  // shows position of lighsource\n  const gridHelper = new THREE.GridHelper(30, 20);\n\n  //scene.add(lightHelper, gridHelper);\n\n  window.addEventListener('resize', function() {\n    camera.aspect = element.width / element.height;\n    camera.updateProjectionMatrix();\n    renderer.setSize(element.width);\n  });\n\n  const controls = new OrbitControls(camera, renderer.domElement);\n\n  var nodes_to_id = {};\n\n/*\n  function resetMaterials() {\n    for (let i = 0; i < scene.children.length; i++) {\n      if (scene.children[i].material) {\n        scene.children[i].material.opacity = 1.0;\n      }\n    }\n  }\n\n\n  function hoverPieces() {\n    raycaster.setFromCamera(mouse, camera);\n    const intersects = raycaster.intersectObjects(scene.children);\n\n    for (let i = 0; i < intersects.length; i++) {\n      const newMaterial = intersects[i].object.material.clone();\n      newMaterial.transparent = true;\n      newMaterial.opacity = 0.5;\n      intersects[i].object.material = newMaterial;\n    }\n  }\n\n  function onClick() {\n    texts.forEach((text) => { removeObject3D(text) });\n\n    raycaster.setFromCamera(mouse, camera);\n    let intersects = raycaster.intersectObjects(scene.children);\n\n    if (intersects.length === 1) {\n      const obj = intersects[0].object;\n      var text = '';\n      nodes_to_id[obj.id].forEach(function (elem) {\n        if (text !== '') {\n          text += ',';\n        }\n        text += ' (';\n        const bin = dec2bin(elem, nodes_ids.length);\n\n        for (let i = 0; i < bin.length; i++) {\n          if (bin[i] === '1') {\n            text += ' ' + nodes_ids[i];\n          }\n        }\n        text += ')';\n      });\n\n      const geometry = new TextGeometry(text, {\n        font : font,\n        size : 1,\n        height : 1,\n      });\n\n      const textMesh = new THREE.Mesh(geometry, [\n        new THREE.MeshPhongMaterial( { color : 0x000000 } )\n      ]);\n\n      textMesh.position.x = obj.position.x;\n      textMesh.position.y = obj.position.y;\n      textMesh.position.z = obj.position.z + 10;\n\n      texts.push(textMesh);\n      scene.add(textMesh);      \n    }\n  }\n\n  function removeObject3D(object3D) {\n    if (!(object3D instanceof THREE.Object3D)) return false;\n\n    // for better memory management and performance\n    if (object3D.geometry) object3D.geometry.dispose();\n\n    if (object3D.material) {\n        if (object3D.material instanceof Array) {\n            // for better memory management and performance\n            object3D.material.forEach(material => material.dispose());\n        } else {\n            // for better memory management and performance\n            object3D.material.dispose();\n        }\n    }\n    object3D.removeFromParent(); // the parent might be the scene or another Object3D, but it is sure to be removed this way\n    return true;\n}\n*/\n\n  processClusters(scene, data);\n  data = null;\n\n  function animate() {\n    setTimeout( function() {\n      requestAnimationFrame( animate );\n    }, 1000 / 5 );\n\n    controls.update();\n   // resetMaterials();\n   // hoverPieces();\n    renderer.render(scene, camera);\n  }\n\n  renderer.setAnimationLoop(animate);\n\n  window.addEventListener( 'click', onClick );\n  window.addEventListener( 'mousemove', onMouseMove );\n\n  window.addEventListener('resize', function() {\n    camera.aspect = element.width / element.width\n    camera.updateProjectionMatrix();\n    renderer.setSize(element.width, element.width);\n  });\n\n  function calcColor(max, val) {\n    return \"hsla(147, 0%, 50%, 1)\";\n    const min = 0\n    var minHue = 240, maxHue=0;\n    var curPercent = (val - min) / (max-min);\n    var colString = \"hsl(\" + ((curPercent * (maxHue-minHue) ) + minHue) + \",65%,50%)\";\n    return colString;\n  }\n\n  function createCylinder( data, id, startPoint, endPoint, currRadius, nextRadius, rank, rank_max) {\n    const color = new THREE.Color( data[id]['Color'] === '' ? calcColor(rank_max, rank) : data[id]['Color'] );\n    //color.setHex(rank/10 * 0xffffff );\n   // color.setHex(rank/10 * 0xffffff );\n\n\n    var cylinderMesh = function( startPoint, endPoint, midPoint, currRadius, nextRadius, color ) {\n      /* edge from X to Y */\n      const direction = new THREE.Vector3().subVectors( endPoint, startPoint );\n\n      const orientation = new THREE.Matrix4();\n      /* THREE.Object3D().up (=Y) default orientation for all objects */\n      orientation.lookAt(startPoint, endPoint, new THREE.Object3D().up);\n\n      /* rotation around axis X by -90 degrees \n      * matches the default orientation Y \n      * with the orientation of looking Z */\n      const mat =  new THREE.Matrix4();\n      mat.set(\n        1,0,0,0,\n        0,0,1,0, \n        0,-1,0,0,\n        0,0,0,1\n      );\n      orientation.multiply(mat);\n\n      /* cylinder: radiusAtTop, radiusAtBottom, \n          height, radiusSegments, heightSegments */\n      const edgeGeometry = new THREE.CylinderGeometry( nextRadius, currRadius, direction.length(), 8, 1);\n      const cylinder = new THREE.Mesh( edgeGeometry, \n              new THREE.MeshPhongMaterial( { color: color, flatShading : true } ) );\n\n      cylinder.applyMatrix4(orientation)\n      cylinder.position.set(midPoint.x, midPoint.y, midPoint.z);\n      nodes_to_id[cylinder.id] = data[id][\"Nodes\"];\n      cylinder.cursor = 'pointer';\n      cylinder.on('click', function(ev) {\n\n        var text = '';\n        data[id][\"Nodes\"].forEach(function (elem) {\n          if (text !== '') {\n            text += ',';\n          }\n          text += ' (';\n          const bin = dec2bin(elem, nodes_ids.length);\n\n          for (let i = 0; i < bin.length; i++) {\n            if (bin[i] === '1') {\n              text += ' ' + nodes_ids[i];\n            }\n          }\n          text += ')';\n        });\n\n        const geometry = new TextGeometry(text, {\n          font : font,\n          size : 1,\n          height : 1,\n        });\n\n        const textMesh = new THREE.Mesh(geometry, [\n          new THREE.MeshPhongMaterial( { color : 0x000000 } )\n        ]);\n\n        textMesh.position.x = cylinder.position.x;\n        textMesh.position.y = cylinder.position.y;\n        textMesh.position.z = cylinder.position.z + 10;\n\n        texts.push(textMesh);\n        scene.add(textMesh);      \n\n      });\n\n      return cylinder;\n    }\n\n    const midPoint = new Point((startPoint.x + endPoint.x) / 2, (startPoint.y + endPoint.y) / 2, (startPoint.z + endPoint.z) / 2);\n    return cylinderMesh(startPoint, endPoint, midPoint, currRadius, nextRadius, color); //new THREE.Mesh(geometryCyl, material);\n\n  }\n\n  // prevPoint, point - upper and downer middle points of cylinder\n  // dirPoint - point to which direction of cylinder (dir vector) should go \n  function clustering(scene, data, id, max_branching, branch_count, prevPointFirst, pointFirst, biggestRank) {\n\n    if (id === undefined) {\n      console.log(\"Id is undefined in clustering\");\n      return;\n    }\n\n    var tuple = Object.freeze({ id: id, prevPoint: prevPointFirst, point: pointFirst });\n    var stack = [ tuple ];\n \n    var count = 0\n\n    while (stack.length > 0) {\n      ++count;\n      const stackElement = stack.pop();\n      const current = stackElement.id;\n      const prevPoint = stackElement.prevPoint;\n      const point = stackElement.point;\n\n      var cluster = data[current];\n      const childCount = cluster[\"Desc\"].length;\n\n      var childsChildCount = 0;\n      for (var i = 0; i < cluster[\"Desc\"].length; ++i) {\n        childsChildCount += data[cluster[\"Desc\"][i]][\"NodeCount\"];\n      }\n\n      var cylinder = createCylinder(data, current, prevPoint, point, cluster.NodeCount, childsChildCount, data[current][\"Rank\"], biggestRank);\n\n      const prevPointPointDist = Math.sqrt((point.x - prevPoint.x) * (point.x - prevPoint.x) + (point.y - prevPoint.y)\n                              * (point.y - prevPoint.y) + (point.z - prevPoint.z) * (point.z - prevPoint.z));\n\n      for (i = 0; i < childCount; ++i) {\n\n        if (childCount === 1) {\n\n            var newStartPoint = new Point(point.x, point.y, point.z); // to make copy\n\n            var offset = 0;\n            if (childsChildCount === cluster[\"Desc\"].length && childsChildCount !== 0 && data[cluster[\"Desc\"][0]][\"Desc\"].length !== 0) {\n              cylinder = undefined; // join same-like cluster to one - draw one cluster with bigger height\n              newStartPoint = new Point(prevPoint.x, prevPoint.y, prevPoint.z); // to make copy\n            }\n\n            const dirVector = new THREE.Vector3(point.x - prevPoint.x, point.y - prevPoint.y, point.z - prevPoint.z);\n            const newPoint = new Point(dirVector.x + point.x, dirVector.y + point.y, dirVector.z + point.z);\n\n            tuple = Object.freeze({ id: cluster[\"Desc\"][0], prevPoint: newStartPoint, point: newPoint });\n            stack.push(tuple);\n          \n          continue;\n        }\n\n        // COMPUTE NEW COORDINATES around circle\n        const theta = 2 * Math.PI / childCount * i;\n\n        var xPos = Math.cos(theta) * childsChildCount;\n        var zPos = Math.sin(theta) * childsChildCount;\n        // this point is not exactly matching with rotation line\n        // it is used to compute vector and later in correct newStartPoint\n        const newStartPointHelper = new Point(point.x + xPos, point.y, point.z + zPos);\n\n        const vector = new THREE.Vector3(newStartPointHelper.x - prevPoint.x, newStartPointHelper.y - prevPoint.y, newStartPointHelper.z - prevPoint.z).normalize();\n        const distance = Math.sqrt(cluster.NodeCount * cluster.NodeCount + prevPointPointDist * prevPointPointDist);\n        newStartPoint = new Point(\n          prevPoint.x + distance * vector.x,\n          prevPoint.y + distance * vector.y,\n          prevPoint.z + distance * vector.z,\n        );\n      \n        const branch_factor = 2 - (1/max_branching * branch_count);\n        xPos = Math.cos(theta) * childsChildCount * branch_factor; // TODO pronasobit constantov pro urceni mensiho/vetsiho uhlu - v ramci hlbky stromu? \n        zPos = Math.sin(theta) * childsChildCount * branch_factor; // TODO\n        const newEndPoint = new Point(newStartPoint.x + xPos, newStartPoint.y - CYLINDER_HEIGHT, newStartPoint.z + zPos);\n      \n        tuple = Object.freeze({ id: cluster[\"Desc\"][i], prevPoint: newStartPoint, point: newEndPoint });\n        stack.push(tuple);\n      }\n\n      if (cylinder !== undefined) {\n        scene.add(cylinder);\n      }\n\n    }\n  }\n\n  function compMaxBranching(data, key) {\n\n    let stack = [ key ];\n    var maximums = {}\n    var colors = {}\n\n    while (stack.length > 0) {\n      const current = stack.pop();\n      colors[current] = 'G';\n      stack.push(current);\n      \n      if (maximums[current] === undefined) {\n        maximums[current] = 0\n      }\n\n      var count_black = 0;\n      const desc_count = data[current][\"Desc\"].length;\n      for (var i = 0; i < desc_count; ++i) {\n        if (colors[data[current][\"Desc\"][i]] === undefined) {\n          stack.push(data[current][\"Desc\"][i]);\n        } \n\n        if (colors[data[current][\"Desc\"][i]] === 'B') {\n          count_black += 1;\n          maximums[current] = Math.max(maximums[ data[current][\"Desc\"][i] ], maximums[current]);\n        }\n      }\n\n      if (count_black === desc_count) {\n        colors[current] = 'B';\n        stack.pop();\n\n        if (desc_count > 1) {\n          maximums[current] += 1;\n        }\n      }\n    }\n\n    return maximums[key];\n  }\n\n  function processClusters(scene, data) {\n\n    var root_cluster_key = undefined;\n    var maxCluster = 1;\n    var biggestRank = 0;\n    Object.entries(data).forEach(([k,v]) => {\n      if (v[\"Rank\"] === 0) {\n        root_cluster_key = k;\n      }\n      biggestRank = Math.max(v[\"Rank\"], biggestRank);\n      maxCluster = Math.max(maxCluster, v.NodeCount);\n    });\n\n    const max_branching = compMaxBranching(data, root_cluster_key);\n\n    const firstHeight = biggestRank * CYLINDER_HEIGHT / 2 + CYLINDER_HEIGHT;\n    const firstStartPoint = new Point(0, firstHeight, 0);\n    const firstEndPoint = new Point(0, firstHeight - CYLINDER_HEIGHT, 0);\n\n    clustering(scene, data, root_cluster_key, max_branching, 1, firstStartPoint, firstEndPoint, biggestRank);\n  }\n}\n\n\n\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}